<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>KingdomCraft Control Panel</title>
<style>
* { margin: 0; padding: 0; box-sizing: border-box; }
body { font-family: 'Segoe UI', sans-serif; background: #0a0a0f; color: #e0e0e0; min-height: 100vh; }

/* Login Screen */
#login-screen {
    display: flex; align-items: center; justify-content: center;
    min-height: 100vh; background: #0a0a0f;
}
#login-box {
    background: #12121a; border: 1px solid #222; border-radius: 12px;
    padding: 40px; width: 360px; text-align: center;
}
#login-box h1 { font-size: 22px; margin-bottom: 8px; color: #fff; }
#login-box p { font-size: 13px; color: #666; margin-bottom: 24px; }
#login-box input {
    width: 100%; padding: 12px 16px; background: #1a1a24; border: 1px solid #333;
    border-radius: 8px; color: #fff; font-size: 14px; margin-bottom: 16px; outline: none;
}
#login-box input:focus { border-color: #4a6cf7; }
#login-box button {
    width: 100%; padding: 12px; background: #4a6cf7; border: none; border-radius: 8px;
    color: #fff; font-size: 14px; font-weight: 600; cursor: pointer; transition: .2s;
}
#login-box button:hover { background: #3b5de7; }
#login-error { color: #f44; font-size: 13px; margin-top: 8px; display: none; }

/* Main Panel */
#panel { display: none; }
header {
    background: #12121a; border-bottom: 1px solid #1a1a24; padding: 16px 32px;
    display: flex; align-items: center; justify-content: space-between;
}
header h1 { font-size: 18px; color: #fff; }
header .status-badge {
    padding: 6px 14px; border-radius: 20px; font-size: 12px; font-weight: 600;
}
header .status-badge.online { background: #0a2a0a; color: #4f4; border: 1px solid #1a3a1a; }
header .status-badge.offline { background: #2a0a0a; color: #f44; border: 1px solid #3a1a1a; }
.logout-btn {
    padding: 6px 14px; background: #222; border: 1px solid #333; border-radius: 6px;
    color: #aaa; font-size: 12px; cursor: pointer;
}
.logout-btn:hover { background: #333; color: #fff; }

.container { max-width: 1100px; margin: 0 auto; padding: 24px; }

/* Cards grid */
.grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); gap: 16px; margin-bottom: 16px; }
.card {
    background: #12121a; border: 1px solid #1e1e28; border-radius: 10px; padding: 20px;
}
.card h2 { font-size: 14px; color: #888; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 14px; }

/* Stats */
.stat-row { display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid #1a1a24; }
.stat-row:last-child { border: none; }
.stat-label { color: #888; font-size: 13px; }
.stat-value { color: #fff; font-size: 13px; font-weight: 600; }

/* Console */
#console-card { grid-column: 1 / -1; }
#console-output {
    background: #080810; border: 1px solid #1a1a24; border-radius: 8px;
    padding: 12px; height: 260px; overflow-y: auto; font-family: 'Consolas', 'Courier New', monospace;
    font-size: 12px; line-height: 1.6; margin-bottom: 12px; color: #aaa;
}
#console-output .cmd { color: #4a6cf7; }
#console-output .res { color: #8f8; }
#console-output .err { color: #f66; }
#console-output .info { color: #888; }
.console-input {
    display: flex; gap: 8px;
}
.console-input input {
    flex: 1; padding: 10px 14px; background: #1a1a24; border: 1px solid #2a2a34;
    border-radius: 8px; color: #fff; font-family: 'Consolas', monospace; font-size: 13px; outline: none;
}
.console-input input:focus { border-color: #4a6cf7; }
.console-input button {
    padding: 10px 20px; background: #4a6cf7; border: none; border-radius: 8px;
    color: #fff; font-weight: 600; cursor: pointer; font-size: 13px;
}

/* Players */
#player-list { max-height: 200px; overflow-y: auto; }
.player-item {
    display: flex; align-items: center; justify-content: space-between;
    padding: 8px 0; border-bottom: 1px solid #1a1a24;
}
.player-item:last-child { border: none; }
.player-name { font-size: 13px; }
.player-actions button {
    padding: 4px 10px; font-size: 11px; border: none; border-radius: 4px;
    cursor: pointer; margin-left: 4px; font-weight: 600;
}
.btn-kick { background: #3a1a1a; color: #f66; }
.btn-kick:hover { background: #4a2020; }
.btn-op { background: #1a2a1a; color: #6f6; }
.btn-op:hover { background: #203a20; }
.btn-deop { background: #2a2a1a; color: #ff8; }
.btn-deop:hover { background: #3a3a20; }
.btn-ban { background: #3a0a0a; color: #f44; }
.btn-ban:hover { background: #4a1010; }

/* Quick Actions */
.actions-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }
.action-btn {
    padding: 10px; border: 1px solid #2a2a34; background: #1a1a24; border-radius: 8px;
    color: #ccc; font-size: 12px; cursor: pointer; text-align: center; font-weight: 500;
    transition: .15s;
}
.action-btn:hover { background: #222230; border-color: #4a6cf7; color: #fff; }
.action-btn.danger { border-color: #3a1a1a; }
.action-btn.danger:hover { background: #2a1010; border-color: #f44; color: #f66; }
.action-btn.active { background: #1a2a1a; border-color: #2a4a2a; color: #4f4; }

/* Whitelist / Properties */
.prop-row {
    display: flex; align-items: center; gap: 8px; margin-bottom: 8px;
}
.prop-row label { font-size: 12px; color: #888; min-width: 120px; }
.prop-row input, .prop-row select {
    flex: 1; padding: 8px 12px; background: #1a1a24; border: 1px solid #2a2a34;
    border-radius: 6px; color: #fff; font-size: 12px; outline: none;
}
.prop-row button {
    padding: 8px 14px; background: #4a6cf7; border: none; border-radius: 6px;
    color: #fff; font-size: 12px; cursor: pointer; font-weight: 600;
}

/* Broadcast */
.broadcast-row { display: flex; gap: 8px; margin-top: 8px; }
.broadcast-row input {
    flex: 1; padding: 10px 14px; background: #1a1a24; border: 1px solid #2a2a34;
    border-radius: 8px; color: #fff; font-size: 13px; outline: none;
}
.broadcast-row button {
    padding: 10px 16px; background: #4a6cf7; border: none; border-radius: 8px;
    color: #fff; font-weight: 600; cursor: pointer;
}

/* Toast */
.toast {
    position: fixed; bottom: 20px; right: 20px; padding: 12px 20px;
    background: #1a1a24; border: 1px solid #2a2a34; border-radius: 8px;
    font-size: 13px; z-index: 999; animation: fadeIn .2s;
}
.toast.success { border-color: #2a4a2a; color: #4f4; }
.toast.error { border-color: #4a1a1a; color: #f44; }
@keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } }

/* Scrollbar */
::-webkit-scrollbar { width: 6px; }
::-webkit-scrollbar-track { background: transparent; }
::-webkit-scrollbar-thumb { background: #333; border-radius: 3px; }
</style>
</head>
<body>

<!-- Login -->
<div id="login-screen">
    <div id="login-box">
        <h1>KingdomCraft</h1>
        <p>Server Control Panel</p>
        <input type="password" id="login-pass" placeholder="Panel Password" autofocus>
        <button onclick="doLogin()">Login</button>
        <div id="login-error">Incorrect password</div>
    </div>
</div>

<!-- Panel -->
<div id="panel">
    <header>
        <h1>KingdomCraft Panel</h1>
        <div style="display:flex;align-items:center;gap:12px;">
            <span id="status-badge" class="status-badge offline">Offline</span>
            <button class="logout-btn" onclick="doLogout()">Logout</button>
        </div>
    </header>

    <div class="container">
        <!-- Row 1: Status + Players -->
        <div class="grid">
            <div class="card">
                <h2>Server Info</h2>
                <div class="stat-row"><span class="stat-label">Status</span><span class="stat-value" id="s-status">--</span></div>
                <div class="stat-row"><span class="stat-label">Players</span><span class="stat-value" id="s-players">--</span></div>
                <div class="stat-row"><span class="stat-label">IP</span><span class="stat-value">continents.cc</span></div>
                <div class="stat-row"><span class="stat-label">Version</span><span class="stat-value">Paper 1.21.1</span></div>
                <div class="stat-row"><span class="stat-label">RCON</span><span class="stat-value" id="s-rcon">--</span></div>
                <div class="stat-row"><span class="stat-label">Lock</span><span class="stat-value" id="s-lock">--</span></div>
            </div>

            <div class="card">
                <h2>Online Players</h2>
                <div id="player-list"><span class="stat-label">Loading...</span></div>
            </div>
        </div>

        <!-- Row 2: Quick Actions + Broadcast/Whitelist -->
        <div class="grid">
            <div class="card">
                <h2>Quick Actions</h2>
                <div class="actions-grid">
                    <button class="action-btn" onclick="panelAction('save')">Save World</button>
                    <button class="action-btn" onclick="panelAction('weather-clear')">Clear Weather</button>
                    <button class="action-btn" onclick="panelAction('time-day')">Set Day</button>
                    <button class="action-btn" onclick="panelAction('time-night')">Set Night</button>
                    <button class="action-btn" id="lock-btn" onclick="panelAction('toggle-lock')">Lock Server</button>
                    <button class="action-btn" onclick="panelAction('whitelist-on')">Whitelist On</button>
                    <button class="action-btn" onclick="panelAction('whitelist-off')">Whitelist Off</button>
                    <button class="action-btn danger" onclick="if(confirm('Stop the server?'))panelAction('stop')">Stop Server</button>
                </div>
            </div>

            <div class="card">
                <h2>Server Controls</h2>
                <p style="font-size:12px;color:#666;margin-bottom:10px;">Broadcast Message</p>
                <div class="broadcast-row">
                    <input type="text" id="broadcast-msg" placeholder="Message to broadcast...">
                    <button onclick="sendBroadcast()">Send</button>
                </div>
                <p style="font-size:12px;color:#666;margin:14px 0 10px;">Whitelist Player</p>
                <div class="prop-row">
                    <input type="text" id="wl-player" placeholder="Player name">
                    <button onclick="whitelistAction('add')">Add</button>
                    <button onclick="whitelistAction('remove')" style="background:#3a1a1a;color:#f66;">Remove</button>
                </div>
                <p style="font-size:12px;color:#666;margin:14px 0 10px;">OP Player</p>
                <div class="prop-row">
                    <input type="text" id="op-player" placeholder="Player name">
                    <button onclick="opAction('op')">OP</button>
                    <button onclick="opAction('deop')" style="background:#3a1a1a;color:#f66;">De-OP</button>
                </div>
                <p style="font-size:12px;color:#666;margin:14px 0 10px;">Ban Player</p>
                <div class="prop-row">
                    <input type="text" id="ban-player" placeholder="Player name">
                    <button onclick="banAction('ban')" style="background:#3a0a0a;color:#f44;">Ban</button>
                    <button onclick="banAction('pardon')">Pardon</button>
                </div>
                <p style="font-size:12px;color:#666;margin:14px 0 10px;">Gamemode</p>
                <div class="prop-row">
                    <input type="text" id="gm-player" placeholder="Player name">
                    <select id="gm-mode">
                        <option value="survival">Survival</option>
                        <option value="creative">Creative</option>
                        <option value="adventure">Adventure</option>
                        <option value="spectator">Spectator</option>
                    </select>
                    <button onclick="setGamemode()">Set</button>
                </div>
                <p style="font-size:12px;color:#666;margin:14px 0 10px;">Teleport Player</p>
                <div class="prop-row">
                    <input type="text" id="tp-player" placeholder="Player" style="max-width:100px;">
                    <input type="text" id="tp-target" placeholder="Target / x y z">
                    <button onclick="teleportPlayer()">TP</button>
                </div>
                <p style="font-size:12px;color:#666;margin:14px 0 10px;">Give Item</p>
                <div class="prop-row">
                    <input type="text" id="give-player" placeholder="Player" style="max-width:100px;">
                    <input type="text" id="give-item" placeholder="minecraft:item">
                    <input type="number" id="give-count" value="1" style="max-width:50px;">
                    <button onclick="giveItem()">Give</button>
                </div>
            </div>
        </div>

        <!-- Row 3: Console -->
        <div class="grid">
            <div class="card" id="console-card">
                <h2>Console</h2>
                <div id="console-output">
                    <div class="info">Type a command below. Commands run via RCON.</div>
                </div>
                <div class="console-input">
                    <input type="text" id="console-cmd" placeholder="Enter server command..." onkeydown="if(event.key==='Enter')sendCommand()">
                    <button onclick="sendCommand()">Run</button>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
const API = '';
let token = localStorage.getItem('panel_token') || '';

// Check saved session
if (token) { showPanel(); refreshAll(); }

function doLogin() {
    const pass = document.getElementById('login-pass').value;
    fetch(API + '/panel/login', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ password: pass })
    })
    .then(r => r.json())
    .then(data => {
        if (data.success) {
            token = data.token;
            localStorage.setItem('panel_token', token);
            showPanel();
            refreshAll();
        } else {
            document.getElementById('login-error').style.display = 'block';
        }
    })
    .catch(() => {
        document.getElementById('login-error').style.display = 'block';
        document.getElementById('login-error').textContent = 'Connection failed';
    });
}

function doLogout() {
    token = '';
    localStorage.removeItem('panel_token');
    document.getElementById('panel').style.display = 'none';
    document.getElementById('login-screen').style.display = 'flex';
}

function showPanel() {
    document.getElementById('login-screen').style.display = 'none';
    document.getElementById('panel').style.display = 'block';
}

function api(path, body) {
    return fetch(API + path, {
        method: body ? 'POST' : 'GET',
        headers: { 'Content-Type': 'application/json', 'Authorization': 'Bearer ' + token },
        body: body ? JSON.stringify(body) : undefined
    }).then(r => {
        if (r.status === 401) { doLogout(); throw new Error('Unauthorized'); }
        return r.json();
    });
}

function toast(msg, type = 'success') {
    const t = document.createElement('div');
    t.className = 'toast ' + type;
    t.textContent = msg;
    document.body.appendChild(t);
    setTimeout(() => t.remove(), 3000);
}

// Refresh status
function refreshStatus() {
    api('/panel/status').then(data => {
        const badge = document.getElementById('status-badge');
        document.getElementById('s-status').textContent = data.serverOnline ? 'Online' : 'Offline';
        document.getElementById('s-players').textContent = data.playerCount;
        document.getElementById('s-rcon').textContent = data.rconConnected ? 'Connected' : 'Disconnected';
        document.getElementById('s-lock').textContent = data.serverLocked ? 'Locked' : 'Open';
        badge.textContent = data.serverOnline ? 'Online' : 'Offline';
        badge.className = 'status-badge ' + (data.serverOnline ? 'online' : 'offline');
        const lockBtn = document.getElementById('lock-btn');
        if (data.serverLocked) {
            lockBtn.textContent = 'Unlock Server';
            lockBtn.className = 'action-btn active';
        } else {
            lockBtn.textContent = 'Lock Server';
            lockBtn.className = 'action-btn';
        }
    }).catch(() => {});
}

// Refresh players
function refreshPlayers() {
    api('/panel/players').then(data => {
        const list = document.getElementById('player-list');
        if (!data.players || data.players.length === 0) {
            list.innerHTML = '<span class="stat-label">No players online</span>';
            return;
        }
        list.innerHTML = data.players.map(p => `
            <div class="player-item">
                <span class="player-name">${p}</span>
                <div class="player-actions">
                    <button class="btn-op" onclick="quickCmd('op ${p}')">OP</button>
                    <button class="btn-deop" onclick="quickCmd('deop ${p}')">DeOP</button>
                    <button class="btn-kick" onclick="quickCmd('kick ${p}')">Kick</button>
                    <button class="btn-ban" onclick="if(confirm('Ban ${p}?'))quickCmd('ban ${p}')">Ban</button>
                </div>
            </div>
        `).join('');
    }).catch(() => {});
}

function refreshAll() {
    refreshStatus();
    refreshPlayers();
}

// Auto-refresh every 10s
setInterval(refreshAll, 10000);

// Console
function sendCommand() {
    const input = document.getElementById('console-cmd');
    const cmd = input.value.trim();
    if (!cmd) return;
    input.value = '';
    appendConsole(cmd, 'cmd');
    api('/panel/command', { command: cmd }).then(data => {
        appendConsole(data.response || 'No output', 'res');
    }).catch(err => {
        appendConsole('Error: ' + err.message, 'err');
    });
}

function appendConsole(text, cls) {
    const out = document.getElementById('console-output');
    const line = document.createElement('div');
    line.className = cls;
    const time = new Date().toLocaleTimeString();
    line.textContent = `[${time}] ${cls === 'cmd' ? '> ' : ''}${text}`;
    out.appendChild(line);
    out.scrollTop = out.scrollHeight;
}

// Quick command
function quickCmd(cmd) {
    api('/panel/command', { command: cmd }).then(data => {
        toast(data.response || 'Done');
        refreshAll();
    }).catch(err => toast('Error: ' + err.message, 'error'));
}

// Quick actions
function panelAction(action) {
    api('/panel/action', { action }).then(data => {
        toast(data.message || 'Done');
        refreshAll();
    }).catch(err => toast('Error: ' + err.message, 'error'));
}

// Broadcast
function sendBroadcast() {
    const msg = document.getElementById('broadcast-msg').value.trim();
    if (!msg) return;
    api('/panel/command', { command: `say ${msg}` }).then(() => {
        toast('Broadcast sent');
        document.getElementById('broadcast-msg').value = '';
    }).catch(err => toast('Error: ' + err.message, 'error'));
}

// Whitelist
function whitelistAction(action) {
    const player = document.getElementById('wl-player').value.trim();
    if (!player) return;
    quickCmd(`whitelist ${action} ${player}`);
    document.getElementById('wl-player').value = '';
}

// OP
function opAction(action) {
    const player = document.getElementById('op-player').value.trim();
    if (!player) return;
    quickCmd(`${action} ${player}`);
    document.getElementById('op-player').value = '';
}

// Ban
function banAction(action) {
    const player = document.getElementById('ban-player').value.trim();
    if (!player) return;
    quickCmd(`${action} ${player}`);
    document.getElementById('ban-player').value = '';
}

// Gamemode
function setGamemode() {
    const player = document.getElementById('gm-player').value.trim();
    const mode = document.getElementById('gm-mode').value;
    if (!player) return;
    quickCmd(`gamemode ${mode} ${player}`);
}

// Teleport
function teleportPlayer() {
    const player = document.getElementById('tp-player').value.trim();
    const target = document.getElementById('tp-target').value.trim();
    if (!player || !target) return;
    quickCmd(`tp ${player} ${target}`);
}

// Give
function giveItem() {
    const player = document.getElementById('give-player').value.trim();
    const item = document.getElementById('give-item').value.trim();
    const count = document.getElementById('give-count').value || '1';
    if (!player || !item) return;
    quickCmd(`give ${player} ${item} ${count}`);
}

// Enter on login
document.getElementById('login-pass').addEventListener('keydown', e => { if (e.key === 'Enter') doLogin(); });
</script>
</body>
</html>
